<div *ngIf="caseInfo">
  <div class="row">
    <div class="col-12 col-lg-3">
      <div class="card rounded-4 case-card-border"
           [ngClass]="{'border-new': caseInfo.crpStatus === 'New',
                        'border-investigation' : caseInfo.crpStatus === 'Investigation',
                        'border-appeal' : caseInfo.crpStatus === 'Appeal',
                        'border-resolved' : caseInfo.crpStatus === 'Resolved',
                        'border-closed' : caseInfo.crpStatus === 'Closed'}">
        <div class="card-body">
          <div class="row">
            <div class="col-8">
              <div class="row">
                <div class="col-12">
                  <i class="bx bx-file text-info fs-5 me-2"></i>
                  <span class="fw-bold fs-5">{{caseInfo.caseNo}}</span>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-12">
                  <i class="bx bx-calendar text-info fs-5 me-2"></i>
                  <span>{{caseInfo.createdDate | date: 'dd-MMM-yyyy | hh:mm a'}}</span>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-12">
                  <i class="bx bx-user text-info fs-5 me-2"></i>
                  <span *ngIf="!caseInfo.isOnBehalf">Myself</span>
                  <span *ngIf="caseInfo.isOnBehalf">
                    On Behalf
                    <span class="d-block ms-4 ps-2" *ngIf="caseInfo.onBehalfName">{{caseInfo.onBehalfName}}</span>
                    <span class="d-block ms-4 ps-2" *ngIf="caseInfo.onBehalfMobileNo">{{caseInfo.onBehalfMobileNo}}</span>
                    <span class="d-block ms-4 ps-2" *ngIf="caseInfo.onBehalfEmail">{{caseInfo.onBehalfEmail}}</span>
                  </span>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-12">
                  <i class="bx bx-time-five align-middle text-info fs-5 me-2"></i>
                  <button class="btn btn-sm btn-outline-new w-lg fw-bold" *ngIf="caseInfo.crpStatus == 'New'">
                    <i class="bx bxs-circle text-new align-middle fs-5 me-2"></i>
                    New
                  </button>
                  <button class="btn btn-sm btn-outline-investigation w-lg fw-bold" *ngIf="caseInfo.crpStatus == 'Investigation'">
                    <i class="bx bxs-circle text-investigation align-middle fs-5 me-2"></i>
                    Investigation
                  </button>
                  <button class="btn btn-sm btn-outline-appeal w-lg fw-bold" *ngIf="caseInfo.crpStatus == 'Appeal'">
                    <i class="bx bxs-circle text-appeal align-middle fs-5 me-2"></i>
                    Appeal
                  </button>
                  <button class="btn btn-sm btn-outline-resolved w-lg fw-bold" *ngIf="caseInfo.crpStatus == 'Resolved'">
                    <i class="bx bxs-circle text-resolved align-middle fs-5 me-2"></i>
                    Resolved
                  </button>
                  <button class="btn btn-sm btn-outline-closed w-lg fw-bold" *ngIf="caseInfo.crpStatus == 'Closed'">
                    <i class="bx bxs-circle text-closed align-middle fs-5 me-2"></i>
                    Closed
                  </button>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="card bg-secondary bg-soft rounded-4 text-center">
                <div class="card-body">
                  <img class="img-fluid" src="assets/images/icms/onlinecontent-1.png" alt="Online Content" *ngIf="caseInfo.caseSectorName == 'Online Content'">
                  <img class="img-fluid" src="assets/images/icms/postalcourier-1.png" alt="Postal & Courier" *ngIf="caseInfo.caseSectorName == 'Postal & Courier'">
                  <img class="img-fluid" src="assets/images/icms/telecommunication-1.png" alt="Telecommunication" *ngIf="caseInfo.caseSectorName == 'Telecommunication'">
                  <img class="img-fluid" src="assets/images/icms/broadcasting-1.png" alt="Broadcasting" *ngIf="caseInfo.caseSectorName == 'Broadcasting'">
                  <img class="img-fluid" src="assets/images/icms/mcmcprovision-1.png" alt="MCMC Provision" *ngIf="caseInfo.caseSectorName == 'MCMC Provision'">
                </div>
              </div>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-12">
              <ul ngbNav #nav1="ngbNav" [(activeId)]="nav1ActiveId" class="nav-pills nav-pills-info nav-justified rounded-1">
                <li [ngbNavItem]="1">
                  <a ngbNavLink class="px-1">
                    <span class="font-size-12">Complaint Details</span>
                  </a>
                  <ng-template ngbNavContent>
                    <ng-template [ngTemplateOutlet]="ComplaintDetailsTab"></ng-template>
                  </ng-template>
                </li>
                <li [ngbNavItem]="2" *ngIf="caseInfo.locationInfo">
                  <a ngbNavLink class="px-1">
                    <span class="font-size-12">Location Details</span>
                  </a>
                  <ng-template ngbNavContent>
                    <ng-template [ngTemplateOutlet]="LocationDetailsTab"></ng-template>
                  </ng-template>
                </li>
              </ul>
              <div [ngbNavOutlet]="nav1"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-9">
      <div class="row">
        <div class="col-12">
          <div class="card rounded-4 case-card-border"
               [ngClass]="{'border-new': caseInfo.crpStatus === 'New',
                            'border-investigation' : caseInfo.crpStatus === 'Investigation',
                            'border-appeal' : caseInfo.crpStatus === 'Appeal',
                            'border-resolved' : caseInfo.crpStatus === 'Resolved',
                            'border-closed' : caseInfo.crpStatus === 'Closed'}">
            <div class="card-body">
              <div class="hori-timeline align-webkit-center">
                <owl-carousel-o [options]="timelineCarousel" class="events navs-carousel">
                  <ng-template carouselSlide *ngFor="let item of caseStatusTimeline; let i = index">
                    <div class="item event-list">
                      <div>
                        <div class="event-down-icon-active align-webkit-center" *ngIf="item.completed">
                          <div class="bg-info rounded-circle position-relative pt-1 custom-timeline-inactive-indicator">
                            <span class="fw-bold font-size-12 custom-timeline-inactive-indicator-number text-white">{{i + 1}}</span>
                          </div>
                        </div>
                        <div class="event-down-icon align-webkit-center" *ngIf="!item.completed">
                          <div class="bg-light rounded-circle position-relative pt-1 custom-timeline-inactive-indicator">
                            <span class="fw-bold font-size-12 custom-timeline-inactive-indicator-number">{{i + 1}}</span>
                          </div>
                        </div>
                        <p class="fw-bold font-size-12 mb-0 pt-2" [ngClass]="item.completed ? 'text-info' : ''">{{item.name}}</p>
                        <div class="px-2" [ngClass]="item.completedDateTime != null ? '' : 'py-2'">
                          <p class="font-size-10 mb-0" *ngIf="item.completedDateTime != null">{{item.completedDateTime | date: 'dd-MMM-yyyy hh:mm a'}}</p>
                        </div>
                      </div>
                    </div>
                  </ng-template>
                </owl-carousel-o>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="latestResolution && latestResolution.hasCaseAgreement && latestResolution.caseAgreementIsAgree == null">
        <div class="col-12">
          <div class="card rounded-4 case-card-border"
               [ngClass]="{'border-new': caseInfo.crpStatus === 'New',
                          'border-investigation' : caseInfo.crpStatus === 'Investigation',
                          'border-appeal' : caseInfo.crpStatus === 'Appeal',
                          'border-resolved' : caseInfo.crpStatus === 'Resolved',
                          'border-closed' : caseInfo.crpStatus === 'Closed'}">
            <div class="card-body">
              <div class="row">
                <div class="col-12 col-lg-8">
                  <ngb-alert [dismissible]="false" type="info" class="mb-0">
                    <i class="fas fa-exclamation-circle text-info align-middle fs-5 me-2"></i>
                    This case is resolved now, are you satisfy with the resolution?
                  </ngb-alert>
                </div>
                <div class="col-12 col-lg-4">
                  <button type="button" class="btn btn-info btn-label waves-light mt-lg-1 me-3" (click)="respondAgreement(true)"><i
                    class="bx bx-happy label-icon"></i> Yes</button>
                  <button type="button" class="btn btn-danger btn-label waves-light mt-lg-1" (click)="respondAgreement(false)"><i
                    class="bx bx-sad label-icon "></i> No</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="card rounded-4 case-card-border"
               [ngClass]="{'border-new': caseInfo.crpStatus === 'New',
                            'border-investigation' : caseInfo.crpStatus === 'Investigation',
                            'border-appeal' : caseInfo.crpStatus === 'Appeal',
                            'border-resolved' : caseInfo.crpStatus === 'Resolved',
                            'border-closed' : caseInfo.crpStatus === 'Closed'}">
            <div class="card-body">
              <div class="row">
                <div class="col-12">
                  <i class="bx bx-pencil text-info fs-5 me-2"></i>
                  <span class="fw-bold fs-6">Complaint Description</span>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-12">
                  <div class="card bg-secondary bg-soft rounded-4 mb-0">
                    <div class="card-body p-2">
                      <div class="row">
                        <div class="col-1 text-center pe-0">
                          <i class="bx bx-mobile text-info fs-3 pt-2"></i>
                        </div>
                        <div class="col-11 ps-0">
                          <p class="text-info mt-2 mb-2">{{caseInfo.description}}</p>
                          <ul class="ps-3 mb-0 font-size-10" *ngIf="caseInfo.attachments">
                            <li class="mt-1" *ngFor="let item of caseInfo.attachments">
                              <span class="text-decoration-underline card-link" (click)="loadAttachment(item)">{{item.fileName}}</span>
                            </li>
                          </ul>

                          <div class="row">
                            <div class="col-12 text-end">
                              <i class="bx bx-calendar text-info fs-5 me-2 align-middle"></i>
                              <small class="fw-bold">{{caseInfo.createdDate | date: 'dd-MMM-yyyy | hh:mm a'}}</small>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="card rounded-4 case-card-border"
               [ngClass]="{'border-new': caseInfo.crpStatus === 'New',
                        'border-investigation' : caseInfo.crpStatus === 'Investigation',
                        'border-appeal' : caseInfo.crpStatus === 'Appeal',
                        'border-resolved' : caseInfo.crpStatus === 'Resolved',
                        'border-closed' : caseInfo.crpStatus === 'Closed'}">
            <div class="card-body px-0">
              <ul ngbNav #nav2="ngbNav" [(activeId)]="nav2ActiveId" class="nav-tabs nav-tabs-custom nav-justified">
                <li [ngbNavItem]="1">
                  <a ngbNavLink class="px-1">
                    <span class="font-size-12">All Conversations</span>
                  </a>
                  <ng-template ngbNavContent>
                    <ng-template [ngTemplateOutlet]="AllConversationsTab"></ng-template>
                  </ng-template>
                </li>
                <li [ngbNavItem]="2" *ngIf="showAppealTab">
                  <a ngbNavLink class="px-1">
                    <span class="font-size-12">Appeal</span>
                  </a>
                  <ng-template ngbNavContent>
                    <ng-template [ngTemplateOutlet]="AppealTab"></ng-template>
                  </ng-template>
                </li>
                <li [ngbNavItem]="3">
                  <a ngbNavLink class="px-1">
                    <span class="font-size-12">Resolution</span>
                  </a>
                  <ng-template ngbNavContent>
                    <ng-template [ngTemplateOutlet]="ResolutionTab"></ng-template>
                  </ng-template>
                </li>
                <li [ngbNavItem]="4">
                  <a ngbNavLink class="px-1">
                    <span class="font-size-12">Attachment</span>
                  </a>
                  <ng-template ngbNavContent>
                    <ng-template [ngTemplateOutlet]="AttachmentTab"></ng-template>
                  </ng-template>
                </li>
                <li [ngbNavItem]="5">
                  <a ngbNavLink class="px-1">
                    <span class="font-size-12">Activity Log</span>
                  </a>
                  <ng-template ngbNavContent>
                    <ng-template [ngTemplateOutlet]="ActivityLogTab"></ng-template>
                  </ng-template>
                </li>
              </ul>
              <div [ngbNavOutlet]="nav2"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Complaint Details Tab Content -->
<ng-template #ComplaintDetailsTab>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">MCMC Related Complaint</p>
      <span *ngIf="caseInfo.caseSectorName">{{caseInfo.caseSectorName}}</span>
      <span *ngIf="!caseInfo.caseSectorName">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Type</p>
      <span *ngIf="caseInfo.caseTypeName">{{caseInfo.caseTypeName}}</span>
      <span *ngIf="!caseInfo.caseTypeName">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Category</p>
      <span *ngIf="caseInfo.caseCategoryName">{{caseInfo.caseCategoryName}}</span>
      <span *ngIf="!caseInfo.caseCategoryName">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Sub Category</p>
      <span *ngIf="caseInfo.caseSubCategoryName">{{caseInfo.caseSubCategoryName}}</span>
      <span *ngIf="!caseInfo.caseSubCategoryName">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Remedy</p>
      <span *ngIf="caseInfo.caseRemedyName">{{caseInfo.caseRemedyName}}</span>
      <span *ngIf="!caseInfo.caseRemedyName">N/A</span>
    </div>
  </div>

  <div class="row mt-3" *ngIf="caseInfo.serviceProviderInfo">
    <div class="col-12">
      <div class="border-bottom border-1 border-info"></div>
    </div>
  </div>

  <div *ngIf="caseInfo.serviceProviderInfo">
    <div class="row mt-3">
      <div class="col-12">
        <i class="bx bx-info-circle text-info font-size-24 align-middle pe-2"></i> <span class="text-info fw-bold fs-6">SERVICE PROVIDER</span>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <p class="text-muted mb-0">Service Provider</p>
        <span *ngIf="caseInfo.serviceProviderInfo.currentSpName">{{caseInfo.serviceProviderInfo.currentSpName}}</span>
        <span *ngIf="!caseInfo.serviceProviderInfo.currentSpName">N/A</span>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <p class="text-muted mb-0">Service Provider Case ID</p>
        <span *ngIf="caseInfo.serviceProviderInfo.spComplaintCaseId">{{caseInfo.serviceProviderInfo.spComplaintCaseId}}</span>
        <span *ngIf="!caseInfo.serviceProviderInfo.spComplaintCaseId">N/A</span>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <p class="text-muted mb-0">Action by Service Provider</p>
        <span *ngIf="caseInfo.serviceProviderInfo.spActionName">{{caseInfo.serviceProviderInfo.spActionName}}</span>
        <span *ngIf="!caseInfo.serviceProviderInfo.spActionName">N/A</span>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <p class="text-muted mb-0">Resolution Note by Service Provider</p>
        <span *ngIf="caseInfo.serviceProviderInfo.resolution">{{caseInfo.serviceProviderInfo.resolution}}</span>
        <span *ngIf="!caseInfo.serviceProviderInfo.resolution">N/A</span>
      </div>
    </div>
  </div>
</ng-template>

<!-- Location Details Tab Content -->
<ng-template #LocationDetailsTab>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Type of Location</p>
      <span *ngIf="caseInfo.locationInfo.locationType">{{caseInfo.locationInfo.locationType}}</span>
      <span *ngIf="!caseInfo.locationInfo.locationType">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Type of House / Building</p>
      <span *ngIf="caseInfo.locationInfo.buildingType">{{caseInfo.locationInfo.buildingType}}</span>
      <span *ngIf="!caseInfo.locationInfo.buildingType">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Building Name</p>
      <span *ngIf="caseInfo.locationInfo.buildingType">{{caseInfo.locationInfo.buildingType}}</span>
      <span *ngIf="!caseInfo.locationInfo.buildingName">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Unit</p>
      <span *ngIf="caseInfo.locationInfo.unitNo">{{caseInfo.locationInfo.unitNo}}</span>
      <span *ngIf="!caseInfo.locationInfo.unitNo">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Floor</p>
      <span *ngIf="caseInfo.locationInfo.floorNo">{{caseInfo.locationInfo.floorNo}}</span>
      <span *ngIf="!caseInfo.locationInfo.floorNo">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Block</p>
      <span *ngIf="caseInfo.locationInfo.block">{{caseInfo.locationInfo.block}}</span>
      <span *ngIf="!caseInfo.locationInfo.block">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Lot</p>
      <span *ngIf="caseInfo.locationInfo.lot">{{caseInfo.locationInfo.lot}}</span>
      <span *ngIf="!caseInfo.locationInfo.lot">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Street</p>
      <span *ngIf="caseInfo.locationInfo.street">{{caseInfo.locationInfo.street}}</span>
      <span *ngIf="!caseInfo.locationInfo.street">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Section</p>
      <span *ngIf="caseInfo.locationInfo.section">{{caseInfo.locationInfo.section}}</span>
      <span *ngIf="!caseInfo.locationInfo.section">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Landmark</p>
      <span *ngIf="caseInfo.locationInfo.landmark">{{caseInfo.locationInfo.landmark}}</span>
      <span *ngIf="!caseInfo.locationInfo.landmark">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">Postcode</p>
      <span *ngIf="caseInfo.locationInfo.postcode">{{caseInfo.locationInfo.postcode}}</span>
      <span *ngIf="!caseInfo.locationInfo.postcode">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">City</p>
      <span *ngIf="caseInfo.locationInfo.cityName">{{caseInfo.locationInfo.cityName}}</span>
      <span *ngIf="!caseInfo.locationInfo.cityName">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">District</p>
      <span *ngIf="caseInfo.locationInfo.districtName">{{caseInfo.locationInfo.districtName}}</span>
      <span *ngIf="!caseInfo.locationInfo.districtName">N/A</span>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-12">
      <p class="text-muted mb-0">State</p>
      <span *ngIf="caseInfo.locationInfo.stateName">{{caseInfo.locationInfo.stateName}}</span>
      <span *ngIf="!caseInfo.locationInfo.stateName">N/A</span>
    </div>
  </div>
</ng-template>

<!-- All Conversations Tab Content -->
<ng-template #AllConversationsTab>
  <div class="p-3">
    <div *ngIf="showCommentSubmission">
      <div class="row mt-4">
        <div class="col-12">
          <span class="fw-bold fs-5">Add Comment</span>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-12">
          <div class="mb-3">
            <label for="caseComment" class="fs-6 text-muted">Comment *</label>
            <textarea id="caseComment" class="form-control" rows="9" [(ngModel)]="caseComment"
                      [ngClass]="{ 'is-invalid': caseCommentSubmitted && (caseComment == null || caseComment.trim() == '') }"></textarea>
            <div *ngIf="caseCommentSubmitted && (caseComment == null || caseComment.trim() == '')" class="invalid-feedback">
              <span>Comment is required</span>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="mb-3">
            <label class="fs-6 text-muted">Attachment</label>
            <div class="row">
              <div class="col-12 mb-3">
                <div class="custom-dropzone-1" (click)="triggerCaseCommentAttachmentDz()">
                  <span class="font-size-10 d-block"><i class="bx bx-upload font-size-14 align-middle me-2"></i>CLick here to upload attachment</span>
                  <span class="font-size-10 text-muted">Max files per upload: 20, Max size per file: 20 MB</span>
                </div>
                <dropzone hidden #caseCommentAttachmentDz
                          [config]="caseCommentAttachmentDzConfig"
                          (sending)="onCaseCommentAttachmentDzSending($event)"
                          (successMultiple)="onCaseCommentAttachmentDzUploadSuccess($event)"
                          (error)="onCaseCommentAttachmentDzUploadFailed($event)"></dropzone>
                <ul class="ps-3 mt-2 mb-0 font-size-10" *ngIf="caseCommentAttachmentList.length > 0">
                  <li class="mt-1" *ngFor="let item of caseCommentAttachmentList">
                    <span class="text-decoration-underline card-link" (click)="loadAttachment(item)">{{item.fileName}}</span>
                    <i class="bx bx-trash ms-2 font-size-16 card-link align-icons" (click)="removeCaseCommentAttachment(item)"></i>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-12 text-end">
          <button class="btn btn-lg btn-info" (click)="doAddComment()">Add Comment</button>
        </div>
      </div>
    </div>
    <div class="row" *ngFor="let conversation of caseInfo.conversations">
      <div class="col-12">
        <div class="row my-4">
          <div class="col-12">
            <div class="border-bottom border-1 border-dark"></div>
          </div>
        </div>

        <div class="row">
          <div class="col-1 text-center pe-0">
            <button type="button" class="btn btn-outline-dark position-relative p-0 avatar-xs rounded-circle">
                <span class="avatar-title bg-transparent text-reset fw-bold">
                    <span *ngIf="conversation.createdBy">{{conversation.createdBy.substring(0,1)}}</span>
                    <span *ngIf="!conversation.createdBy">A</span>
                </span>
            </button>
          </div>
          <div class="col-11 ps-0">
            <div class="row">
              <div class="col-12 col-lg-6 pt-2">
                <span class="fw-bold" *ngIf="conversation.createdBy">{{conversation.createdBy}}</span>
                <span class="fw-bold" *ngIf="!conversation.createdBy">Automation</span>
                <span class="mx-4">|</span>
                <span class="text-muted">{{conversation.createdDate | date: 'dd-MMM-yyyy hh:mm a'}}</span>
              </div>
              <div class="col-12 col-lg-6 text-end">
                <div *ngIf="conversation.createdByIntUserGroupList">
                  <div class="d-inline" *ngFor="let item of conversation.createdByIntUserGroupList">
                    <button class="btn btn-outline-success btn-rounded ms-2" *ngIf="item == 'Service Provider'">
                      <i class="bx bxs-user font-size-14 align-middle me-2"></i>Service Provider
                    </button>
                    <button class="btn btn-outline-info btn-rounded ms-2" *ngIf="item == 'Forum'">
                      <i class="bx bxs-user font-size-14 align-middle me-2"></i>Forum
                    </button>
                    <button class="btn btn-outline-dark btn-rounded ms-2" *ngIf="item == 'MCMC'">
                      <i class="bx bxs-user font-size-14 align-middle me-2"></i>MCMC
                    </button>
                  </div>
                </div>
                <p class="mb-0 text-warning fw-bold mt-3" *ngIf="conversation.appealIndicator">Appeal ({{conversation.appealIndicator}})</p>
              </div>
            </div>
            <div class="row mt-3">
              <p>{{conversation.message}}</p>
              <ul class="ps-3 mb-0 font-size-10">
                <li class="mt-1" *ngFor="let item of conversation.attachments">
                  <span class="text-decoration-underline card-link" *ngIf="conversation.type == 'caseDescription'" (click)="loadAttachment(item)">{{item.fileName}}</span>
                  <span class="text-decoration-underline card-link" *ngIf="conversation.type == 'caseComment'" (click)="loadAttachment(item)">{{item.fileName}}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Appeal Tab Content -->
<ng-template #AppealTab>
  <div class="p-3">
    <div class="row mt-4" *ngIf="caseInfo.appealComments.length == 0">
      <div class="col-12">
        <i class="bx bxs-info-circle text-muted fs-5 me-2 align-middle"></i>
        <span class="text-muted">Sorry, this case is still under investigation, no appeal found at the moment</span>
      </div>
    </div>
    <div *ngIf="caseInfo.appealComments.length > 0">
      <div class="row" *ngFor="let comment of caseInfo.appealComments">
        <div class="col-12">
          <div class="row my-4">
            <div class="col-12">
              <div class="border-bottom border-1 border-dark"></div>
            </div>
          </div>

          <div class="row">
            <div class="col-1 text-center pe-0">
              <button type="button" class="btn btn-outline-dark position-relative p-0 avatar-xs rounded-circle">
                <span class="avatar-title bg-transparent text-reset fw-bold">
                    <span *ngIf="comment.createdBy">{{comment.createdBy.substring(0,1)}}</span>
                    <span *ngIf="!comment.createdBy">A</span>
                </span>
              </button>
            </div>
            <div class="col-11 ps-0">
              <div class="row">
                <div class="col-12 col-lg-6 pt-2">
                  <span class="fw-bold" *ngIf="comment.createdBy">{{comment.createdBy}}</span>
                  <span class="fw-bold" *ngIf="!comment.createdBy">Automation</span>
                  <span class="mx-4">|</span>
                  <span class="text-muted">{{comment.createdDate | date: 'dd-MMM-yyyy hh:mm a'}}</span>
                </div>
                <div class="col-12 col-lg-6 text-end">
                  <div *ngIf="comment.createdByIntUserGroupList">
                    <div class="d-inline" *ngFor="let item of comment.createdByIntUserGroupList">
                      <button class="btn btn-outline-success btn-rounded ms-2" *ngIf="item == 'Service Provider'">
                        <i class="bx bxs-user font-size-14 align-middle me-2"></i>Service Provider
                      </button>
                      <button class="btn btn-outline-info btn-rounded ms-2" *ngIf="item == 'Forum'">
                        <i class="bx bxs-user font-size-14 align-middle me-2"></i>Forum
                      </button>
                      <button class="btn btn-outline-dark btn-rounded ms-2" *ngIf="item == 'MCMC'">
                        <i class="bx bxs-user font-size-14 align-middle me-2"></i>MCMC
                      </button>
                    </div>
                  </div>
                  <p class="mb-0 text-warning fw-bold mt-3" *ngIf="comment.appealIndicator">Appeal ({{comment.appealIndicator}})</p>
                </div>
              </div>
              <div class="row mt-3">
                <p>{{comment.message}}</p>
                <ul class="ps-3 mb-0 font-size-10">
                  <li class="mt-1" *ngFor="let item of comment.attachments">
                    <span class="text-decoration-underline card-link" (click)="loadCaseCommentAttachment(item)">{{item.fileName}}</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Resolution Tab Content -->
<ng-template #ResolutionTab>
  <div class="p-3">
    <div class="row mt-4" *ngIf="caseInfo.resolutions.length == 0">
      <div class="col-12">
        <i class="bx bxs-info-circle text-muted fs-5 me-2 align-middle"></i>
        <span class="text-muted">Sorry, this case is still under investigation, no resolution found at the moment</span>
      </div>
    </div>
    <div *ngIf="caseInfo.resolutions.length > 0">
      <div class="row" *ngFor="let resolution of caseInfo.resolutions">
        <div class="col-12">
          <div class="row my-4">
            <div class="col-12">
              <div class="border-bottom border-1 border-dark"></div>
            </div>
          </div>

          <div class="row">
            <div class="col-1 text-center pe-0">
              <button type="button" class="btn btn-outline-dark position-relative p-0 avatar-xs rounded-circle">
                <span class="avatar-title bg-transparent text-reset fw-bold">
                    <span *ngIf="resolution.createdBy">{{resolution.createdBy.substring(0,1)}}</span>
                    <span *ngIf="!resolution.createdBy">A</span>
                </span>
              </button>
            </div>
            <div class="col-11 ps-0">
              <div class="row">
                <div class="col-12 col-lg-6 pt-2">
                  <span class="fw-bold" *ngIf="resolution.createdBy">{{resolution.createdBy}}</span>
                  <span class="fw-bold" *ngIf="!resolution.createdBy">Automation</span>
                  <span class="mx-4">|</span>
                  <span class="text-muted">{{resolution.createdDate | date: 'dd-MMM-yyyy hh:mm a'}}</span>
                </div>
                <div class="col-12 col-lg-6 text-end">
                  <div *ngIf="resolution.createdByIntUserGroupList">
                    <div class="d-inline" *ngFor="let item of resolution.createdByIntUserGroupList">
                      <button class="btn btn-outline-success btn-rounded ms-2" *ngIf="item == 'Service Provider'">
                        <i class="bx bxs-user font-size-14 align-middle me-2"></i>Service Provider
                      </button>
                      <button class="btn btn-outline-info btn-rounded ms-2" *ngIf="item == 'Forum'">
                        <i class="bx bxs-user font-size-14 align-middle me-2"></i>Forum
                      </button>
                      <button class="btn btn-outline-dark btn-rounded ms-2" *ngIf="item == 'MCMC'">
                        <i class="bx bxs-user font-size-14 align-middle me-2"></i>MCMC
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mt-3">
                <p>{{resolution.resolution}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Attachment Tab Content -->
<ng-template #AttachmentTab>
  <div class="p-3">
    <div class="row mt-4">
      <div class="col-12">
        <ngx-datatable #allAttachmentsTable class="material mb-3"
                       [rows]="allAttachments"
                       [columnMode]="'flex'"
                       [headerHeight]="40"
                       [footerHeight]="50"
                       [rowHeight]="'auto'"
                       [externalPaging]="true"
                       [count]="allAttachments.length"
                       [offset]="0"
                       [limit]="20">
          <ngx-datatable-column name="No" headerClass="custom-table-1-header" cellClass="custom-table-1-cell" [sortable]="false" [flexGrow]="0.5">
            <ng-template let-rowIndex="rowIndex" let-row="row" ngx-datatable-cell-template>
              {{rowIndex + 1}}
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Attachment" headerClass="custom-table-1-header" cellClass="custom-table-1-cell" [sortable]="false" [flexGrow]="3">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <a class="card-link" (click)="loadAttachment(row)">{{row.fileName}}</a>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Uploaded By" headerClass="custom-table-1-header" cellClass="custom-table-1-cell" [sortable]="false" [flexGrow]="1.5">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <span *ngIf="row.createdBy">{{row.createdBy}}</span>
              <span *ngIf="!row.createdBy">N/A</span>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Uploaded Date" headerClass="custom-table-1-header" cellClass="custom-table-1-cell" [sortable]="false" [flexGrow]="1.5">
            <ng-template let-row="row" ngx-datatable-cell-template>
              {{row.createdDate | date: 'dd-MMM-yyy hh:mm a'}}
            </ng-template>
          </ngx-datatable-column>
        </ngx-datatable>
      </div>
    </div>
  </div>
</ng-template>

<!-- Activity Log Tab Content -->
<ng-template #ActivityLogTab>
  <div class="p-3">
    <div class="row mt-3">
      <div class="col-12">
        <ul class="verti-timeline list-unstyled">
          <li class="event-list pb-2" *ngFor="let timeline of caseInfo.timelines">
            <div class="event-timeline-dot">
              <i class="bx bxs-circle text-dark mt-4"></i>
            </div>
            <div class="card rounded-4 border border-light mb-0">
              <div class="card-body p-3">
                <div class="d-flex">
                  <div class="flex-shrink-0 align-self-center me-2">
                    <button type="button" class="btn btn-outline-dark position-relative p-0 avatar-xs rounded-circle">
                      <span class="avatar-title bg-transparent text-reset fw-bold">
                        <span *ngIf="timeline.createdBy">{{timeline.createdBy.substring(0,1)}}</span>
                        <span *ngIf="!timeline.createdBy">A</span>
                      </span>
                    </button>
                  </div>
                  <div class="align-self-center">
                    <span class="text-info" *ngIf="timeline.createdBy">{{timeline.createdBy}}</span>
                    <span class="text-info" *ngIf="!timeline.createdBy">Automation</span>
                  </div>
                  <div class="flex-grow-1 align-self-center ps-5 pe-3">
                    <span>{{timeline.description}}</span>
                  </div>
                  <div class="align-self-center">
                    <i class="bx bx-calendar text-info fs-5 me-2"></i>
                    <span>{{timeline.timestamp | date: 'dd-MMM-yyyy hh:mm a'}}</span>
                  </div>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</ng-template>
